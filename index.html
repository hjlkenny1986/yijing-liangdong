<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å‘¨æ˜“æœ‰ç­”æ¡ˆ - è¯¦ç»†æ‰‹å†Œ</title>
    <style>
        :root { --p: #37352f; --bg: #ffffff; --s-bg: #f7f6f3; --accent: #a44d11; }
        body { font-family: system-ui; color: var(--p); background: var(--bg); margin: 0; padding: 0; line-height: 1.6; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        #home, #list, #detail { display: none; }
        .active { display: block !important; }
        
        /* æŒ‰é’®ä¸å¡ç‰‡ */
        .btn { display: block; width: 100%; padding: 15px; margin: 15px 0; border: 1px solid #ddd; border-radius: 10px; background: var(--s-bg); text-align: center; font-size: 1.1rem; cursor: pointer; }
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .card { padding: 10px; border: 1px solid #eee; text-align: center; border-radius: 8px; font-size: 0.9rem; }
        
        /* è¯¦æƒ…å†…å®¹ */
        .section { margin: 20px 0; padding: 15px; background: var(--s-bg); border-radius: 10px; }
        .section h3 { margin-top: 0; color: var(--accent); border-bottom: 1px solid #ddd; padding-bottom: 5px; }
        .yao-item { padding: 10px 0; border-bottom: 1px dashed #ccc; font-size: 0.95rem; }
        textarea { width: 100%; height: 120px; padding: 10px; box-sizing: border-box; border-radius: 8px; border: 1px solid #ddd; margin: 10px 0; }
        .save-btn { width: 100%; padding: 12px; background: var(--p); color: white; border: none; border-radius: 8px; }
        .nav { text-align: center; margin: 30px 0; color: #888; text-decoration: underline; cursor: pointer; }
    </style>
</head>
<body>
<div class="container">
    <div id="home" class="active">
        <h1 style="text-align:center; margin-top:50px;">â˜¯ï¸ å‘¨æ˜“æœ‰ç­”æ¡ˆ</h1>
        <p style="text-align:center; color:#666;">æ¢å†¬è§†è§’ Â· è¯¦ç»†å®æˆ˜ç¬”è®°</p>
        <div onclick="showRandom()" class="btn" style="background:var(--p); color:white;">ğŸ² éšæœºèµ·ä¸€å¦</div>
        <div onclick="showList()" class="btn">ğŸ“š è¯¦ç»†å…­åå››å¦åå½•</div>
    </div>

    <div id="list">
        <h3>å…­åå››å¦æ£€ç´¢</h3>
        <div id="gua-grid" class="grid"></div>
        <div class="nav" onclick="goHome()">è¿”å›é¦–é¡µ</div>
    </div>

    <div id="detail">
        <h2 id="d-name"></h2>
        <div class="section">
            <h3>ğŸŒŸ æ ¸å¿ƒæ™ºæ…§ (æ¢å†¬æ·±åº¦è§£è¯»)</h3>
            <p id="d-quote" style="white-space: pre-wrap;"></p>
        </div>
        <div class="section">
            <h3>ğŸ” è§£å¦å®æˆ˜æ‰‹å†Œ</h3>
            <p><strong>èƒ½é‡/å¤„å¢ƒï¼š</strong><br><span id="d-state"></span></p>
            <p><strong>é¿å‘/æé†’ï¼š</strong><br><span id="d-warn"></span></p>
            <p><strong>è¡ŒåŠ¨å»ºè®®ï¼š</strong><br><span id="d-advice"></span></p>
        </div>
        <div class="section">
            <h3>ğŸ“œ å…­çˆ»è¯¦è§£</h3>
            <div id="d-yao"></div>
        </div>
        <div class="section" style="background:#fffef0;">
            <h3>ğŸ“ å®æˆ˜è®°å½•ä¸æ„Ÿæ‚Ÿ</h3>
            <textarea id="user-note" placeholder="ç‚¹å‡»è¿™é‡Œè¾“å…¥ä½ çš„è§£å¦æ¡ˆä¾‹æˆ–å¤ä¹ å¿ƒæ³•..."></textarea>
            <button class="save-btn" onclick="saveNote()">ä¿å­˜åˆ°æ‰‹æœºæœ¬åœ°</button>
            <p id="status" style="font-size:12px; color:green; text-align:center;"></p>
        </div>
        <div class="nav" onclick="goHome()">è¿”å›é¦–é¡µ</div>
    </div>
</div>
<div id="workbench" style="background:#f9f9f9; padding:20px; border:2px solid #eee; margin:20px 0; border-radius:10px;">
    <h3>ğŸ”® æ·±åº¦è§£å¦å·¥ä½œå°</h3>
    
    <div style="margin-bottom:15px;">
        <input type="number" id="num1" placeholder="æ•°å­—1(ä¸‹å¦)" style="width:80px;">
        <input type="number" id="num2" placeholder="æ•°å­—2(ä¸Šå¦)" style="width:80px;">
        <input type="number" id="num3" placeholder="æ•°å­—3(åŠ¨çˆ»)" style="width:80px;">
        <button onclick="calculateGua()">è‡ªåŠ¨èµ·å¦</button>
    </div>

    <div id="report-area" style="display:none;">
        <p><strong>å¦è±¡ï¼š</strong> <span id="report-gua-name"></span></p>
        <p>æ ¸å¿ƒå»ºè®®ï¼ˆå¯ä¿®æ”¹ï¼‰ï¼š</p>
        <textarea id="edit-advice" style="width:100%; height:80px; margin-bottom:10px;"></textarea>
        
        <p>æ™ºæ…§ï¼ˆå¯ä¿®æ”¹ï¼‰ï¼š</p>
        <textarea id="edit-quote" style="width:100%; height:80px; margin-bottom:10px;"></textarea>

        <p>æˆ‘çš„å®æˆ˜æ„Ÿæ‚Ÿï¼ˆæ‰‹åŠ¨è¾“å…¥ï¼‰ï¼š</p>
        <textarea id="my-insight" placeholder="åœ¨è¿™é‡Œè¾“å…¥ä½ å¯¹æ±‚å¦äººçš„é’ˆå¯¹æ€§åˆ†æ..." style="width:100%; height:100px; border:1px solid #d4a017;"></textarea>

        <div style="margin-top:15px;">
            <button onclick="exportText()" style="background:#2c3e50; color:white;">ç”Ÿæˆæ–‡å­—æŠ¥å‘Š</button>
            <button onclick="exportImage()" style="background:#d4a017; color:white;">ç”Ÿæˆå›¾ç‰‡æŠ¥å‘Š (æˆªå›¾æ¨¡å¼)</button>
        </div>
    </div>
</div>
<script src="data.js"></script>
<script>
    let currentId = "";
    function init() {
        const grid = document.getElementById('gua-grid');
        grid.innerHTML = "";
        for (let i = 1; i <= 64; i++) {
            let id = i.toString().padStart(2, '0');
            let card = document.createElement('div');
            card.className = 'card';
            card.innerText = guaData[id] ? guaData[id].name : id + " å¾…æ›´æ–°";
            card.onclick = () => showDetail(id);
            grid.appendChild(card);
        }
    }
    function showDetail(id) {
        const data = guaData[id];
        if (!data) { alert("è¯¥å¦è±¡è¯¦ç»†å†…å®¹æ­£åœ¨æ•´ç†ä¸­ï¼Œè¯·ç­‰å¾…ä¸‹ä¸€æ‰¹æ›´æ–°ï¼"); return; }
        currentId = id;
        document.getElementById('home').className = "";
        document.getElementById('list').className = "";
        document.getElementById('detail').className = "active";
        document.getElementById('d-name').innerText = data.name;
        document.getElementById('d-quote').innerText = data.quote;
        document.getElementById('d-state').innerText = data.state;
        document.getElementById('d-warn').innerText = data.warn;
        document.getElementById('d-advice').innerText = data.advice;
        document.getElementById('d-yao').innerHTML = data.yao.map(y => `<div class="yao-item">${y}</div>`).join('');
        document.getElementById('user-note').value = localStorage.getItem('yj_note_' + id) || "";
        window.scrollTo(0,0);
    }
    function showRandom() { const keys = Object.keys(guaData); showDetail(keys[Math.floor(Math.random()*keys.length)]); }
    function showList() { document.getElementById('home').className = ""; document.getElementById('detail').className = ""; document.getElementById('list').className = "active"; }
    function goHome() { document.getElementById('home').className = "active"; document.getElementById('detail').className = ""; document.getElementById('list').className = ""; }
    function saveNote() { 
        localStorage.setItem('yj_note_' + currentId, document.getElementById('user-note').value);
        document.getElementById('status').innerText = "å·²ä¿å­˜ï¼å³ä½¿å…³é—­ç½‘é¡µä¹Ÿä¸ä¼šä¸¢å¤±ã€‚";
        setTimeout(() => document.getElementById('status').innerText="", 2000);
    }
    // æ•°å­—èµ·å¦é€»è¾‘
function calculateGua() {
    const n1 = document.getElementById('num1').value;
    const n2 = document.getElementById('num2').value;
    const n3 = document.getElementById('num3').value;

    if(!n1 || !n2 || !n3) { alert("è¯·å¡«å…¥ä¸‰ä¸ªæ•°å­—"); return; }

    // æ˜“ç»æ±‚ä½™ç®—æ³•
    let lower = n1 % 8 || 8; 
    let upper = n2 % 8 || 8;
    let motion = n3 % 6 || 6;

    // è¿™é‡Œéœ€è¦ä¸€ä¸ªç®€å•çš„å¯¹åº”è¡¨å°†æ•°å­—è½¬ä¸ºå¦åºï¼Œæˆ–è€…ç›´æ¥è®©ä½ é€‰æ‹©å¦è±¡
    // ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å…ˆå®ç°å¼¹å‡ºå¯¹åº”å¦è±¡æ•°æ®åˆ°ç¼–è¾‘æ¡†
    alert("èµ·å¦æˆåŠŸï¼è¯·åœ¨ä¸‹æ–¹è°ƒæ•´è§£å¦å†…å®¹ã€‚");
    document.getElementById('report-area').style.display = 'block';
    
    // å‡è®¾ä½ å½“å‰é€‰ä¸­çš„æ˜¯æŸä¸ªå¦ï¼Œè‡ªåŠ¨å¡«å…¥
    // è¿™é‡Œçš„ currentGua æ˜¯ä½ ç‚¹å‡»æˆ–è®¡ç®—å‡ºæ¥çš„å¦è±¡å¯¹è±¡
    const data = guaData["01"]; // ä¸¾ä¾‹ï¼Œå®é™…å¯æ ¹æ®è®¡ç®—ç»“æœåŒ¹é…
    document.getElementById('report-gua-name').innerText = data.name;
    document.getElementById('edit-advice').value = data.advice;
    document.getElementById('edit-quote').value = data.quote;
}

// ç”Ÿæˆæ–‡å­—æŠ¥å‘Š
function exportText() {
    const guaName = document.getElementById('report-gua-name').innerText;
    const advice = document.getElementById('edit-advice').value;
    const quote = document.getElementById('edit-quote').value;
    const insight = document.getElementById('my-insight').value;

    const fullReport = `ã€å‘¨æ˜“æœ‰ç­”æ¡ˆÂ·è§£å¦æŠ¥å‘Šã€‘\n\nå¦è±¡ï¼š${guaName}\n\nå»ºè®®ï¼š${advice}\n\næ¢å†¬æ™ºæ…§ï¼š${quote}\n\nå®æˆ˜æ„Ÿæ‚Ÿï¼š${insight}\n\nâ€”â€” ç¥å›é¡ºé‚ â€”â€”`;
    
    // è‡ªåŠ¨å¤åˆ¶åˆ°å‰ªè´´æ¿
    navigator.clipboard.writeText(fullReport).then(() => {
        alert("æ–‡å­—æŠ¥å‘Šå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œå¯ä»¥ç›´æ¥ç²˜è´´å‘é€ç»™æœ‹å‹ï¼");
    });
}

// ç”Ÿæˆå›¾ç‰‡å»ºè®®ï¼š
// ç”Ÿæˆå›¾ç‰‡é€šå¸¸éœ€è¦ html2canvas æ’ä»¶ã€‚
// ç®€å•åšæ³•æ˜¯æç¤ºç”¨æˆ·ï¼šè¯·è°ƒæ•´å¥½å†…å®¹åï¼Œä½¿ç”¨æ‰‹æœºæˆªå±ï¼Œè¿™å°±æ˜¯æœ€å¥½çš„â€œå›¾ç‰‡æŠ¥å‘Šâ€ã€‚
function exportImage() {
    alert("è¯·éšè—ä¾§è¾¹æ ï¼Œç›´æ¥å¯¹å½“å‰æ©™è‰²è¾¹æ¡†åŒºåŸŸè¿›è¡Œæˆªå±ï¼Œå³å¯å¾—åˆ°æœ€ç²¾ç¾çš„æŠ¥å‘Šå›¾ç‰‡ï¼");
}
    window.onload = init;
</script>
</body>
</html>
