<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å‘¨æ˜“æœ‰ç­”æ¡ˆ - å®æˆ˜è§£å¦æ‰‹å†Œ</title>
    <style>
        :root { --p: #37352f; --bg: #ffffff; --s-bg: #f7f6f3; --accent: #a44d11; --gold: #d4a017; }
        body { font-family: system-ui, -apple-system, sans-serif; color: var(--p); background: var(--bg); margin: 0; padding: 0; line-height: 1.6; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        
        /* é¡µé¢åˆ‡æ¢æ§åˆ¶ */
        #home, #list, #detail { display: none; }
        .active { display: block !important; }

        /* é¦–é¡µä¸æŒ‰é’® */
        h1 { font-size: 1.8rem; text-align: center; margin-top: 40px; color: var(--accent); }
        .btn { display: block; width: 100%; padding: 15px; margin: 15px 0; border: 1px solid #ddd; border-radius: 12px; background: var(--s-bg); text-align: center; font-size: 1.1rem; cursor: pointer; transition: 0.2s; box-sizing: border-box; }
        .btn:active { background: #ebeae4; }
        
        /* åˆ—è¡¨ç½‘æ ¼ */
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .card { padding: 12px 5px; border: 1px solid #eee; text-align: center; border-radius: 8px; font-size: 0.9rem; cursor: pointer; background: white; }

        /* è¯¦æƒ…é¡µæ ·å¼ */
        .section { margin: 25px 0; border-bottom: 1px solid #f0f0f0; padding-bottom: 15px; }
        .label { font-weight: bold; color: var(--accent); margin-bottom: 8px; font-size: 0.9rem; text-transform: uppercase; }
        .yao-item { background: var(--s-bg); padding: 10px; margin-bottom: 8px; border-radius: 6px; font-size: 0.95rem; }

        /* --- èµ·å¦å·¥ä½œå°æ ·å¼ --- */
        #workbench { background: #fffcf5; padding: 20px; border: 2px solid var(--gold); margin: 30px 0; border-radius: 15px; }
        .wb-title { color: var(--gold); font-weight: bold; margin-top: 0; text-align: center; }
        .input-group { display: flex; gap: 10px; margin-bottom: 15px; justify-content: center; }
        .input-group input { width: 70px; padding: 10px; border: 1px solid #ccc; border-radius: 5px; text-align: center; }
        .calc-btn { background: var(--gold); color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        
        textarea { width: 100%; border: 1px solid #ddd; border-radius: 8px; padding: 10px; font-size: 0.95rem; box-sizing: border-box; font-family: inherit; }
        .report-btns { display: flex; gap: 10px; margin-top: 15px; }
        .report-btns .btn { font-size: 0.9rem; padding: 10px; margin: 0; }
        
        .nav-bar { position: sticky; bottom: 0; background: rgba(255,255,255,0.9); display: flex; border-top: 1px solid #eee; padding: 10px 0; backdrop-filter: blur(10px); }
        .nav-bar div { flex: 1; text-align: center; font-size: 0.8rem; color: #888; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <div id="home" class="active">
        <h1>å‘¨æ˜“æœ‰ç­”æ¡ˆ</h1>
        <p style="text-align:center; color:#888;">æ¢å†¬ã€Šå‘¨æ˜“æœ‰ç­”æ¡ˆã€‹æ·±åº¦å¤ä¹ å·¥å…·</p>
        <div class="btn" onclick="showRandom()">ğŸ² æ¯æ—¥éšæœºå¤ä¹ </div>
        <div class="btn" onclick="showList()">ğŸ“– 64 å¦é€ŸæŸ¥è¡¨</div>
    </div>

    <div id="list">
        <div class="btn" onclick="goHome()">â† è¿”å›é¦–é¡µ</div>
        <div class="grid" id="grid"></div>
    </div>

    <div id="detail">
        <div class="btn" onclick="showList()">â† è¿”å›åˆ—è¡¨</div>
        
        <h2 id="d-name" style="color:var(--accent); margin-bottom:5px;"></h2>
        
        <div id="workbench">
            <p class="wb-title">ğŸ”® æ·±åº¦è§£å¦å·¥ä½œå°</p>
            <div class="input-group">
                <input type="number" id="num1" placeholder="æ•°å­—1">
                <input type="number" id="num2" placeholder="æ•°å­—2">
                <input type="number" id="num3" placeholder="æ•°å­—3">
                <button class="calc-btn" onclick="calculateGua()">è‡ªåŠ¨èµ·å¦</button>
            </div>

            <div id="report-area" style="display:none;">
                <p><strong>å½“å‰ç»“æœï¼š</strong> <span id="report-gua-title" style="color:var(--accent);"></span></p>
                
                <div class="label">1. è¡ŒåŠ¨æŒ‡å¼• (å¯ä¿®æ”¹)</div>
                <textarea id="edit-advice" rows="3"></textarea>

                <div class="label">2. æ·±åº¦è§£è¯»ä¸åŠ¨çˆ» (å¯ä¿®æ”¹)</div>
                <textarea id="edit-quote" rows="5"></textarea>

                <div class="label">3. æˆ‘çš„å®æˆ˜æ„Ÿæ‚Ÿ (ç‚¹å‡»è¾“å…¥)</div>
                <textarea id="my-insight" placeholder="åœ¨è¿™é‡Œè¾“å…¥é’ˆå¯¹æ±‚å¦äººçš„å…·ä½“å»ºè®®..." rows="4"></textarea>

                <div class="report-btns">
                    <div class="btn" style="background:#2c3e50; color:white;" onclick="exportText()">å¤åˆ¶æ–‡å­—</div>
                    <div class="btn" style="background:var(--accent); color:white;" onclick="exportImage()">å›¾ç‰‡é¢„è§ˆ</div>
                </div>
            </div>
        </div>

        <div class="section"><div class="label">æ¢å†¬é‡‘å¥</div><div id="d-quote"></div></div>
        <div class="section"><div class="label">è¯¦ç»†æ„è±¡</div><div id="d-state"></div></div>
        <div class="section"><div class="label">é¿å‘æŒ‡å—</div><div id="d-warn"></div></div>
        <div class="section"><div class="label">è¡ŒåŠ¨å»ºè®®</div><div id="d-advice"></div></div>
        <div class="section"><div class="label">å…­çˆ»è¾</div><div id="d-yao"></div></div>
    </div>
</div>

<div class="nav-bar">
    <div onclick="goHome()">ğŸ  é¦–é¡µ</div>
    <div onclick="showList()">ğŸ” æŸ¥å¦</div>
    <div onclick="showRandom()">ğŸ² éšæœº</div>
</div>

<script src="data.js"></script>
<script>
    let currentId = "";

    // åˆå§‹åŒ–ï¼šä» data.js åŠ è½½åˆ—è¡¨
    function init() {
        const grid = document.getElementById('grid');
        if (typeof guaData === 'undefined') {
            alert("æœªæ‰¾åˆ° data.js æ–‡ä»¶ï¼Œè¯·ç¡®ä¿å®ƒä¸ HTML åœ¨åŒä¸€æ–‡ä»¶å¤¹ã€‚");
            return;
        }
        Object.keys(guaData).sort().forEach(id => {
            const div = document.createElement('div');
            div.className = 'card';
            div.innerText = id + " " + guaData[id].name.split('.')[1].split('(')[0].trim();
            div.onclick = () => showDetail(id);
            grid.appendChild(div);
        });
    }

    // æ˜¾ç¤ºå¦è±¡è¯¦æƒ…
    function showDetail(id) {
        currentId = id;
        const data = guaData[id];
        document.getElementById('home').className = "";
        document.getElementById('list').className = "";
        document.getElementById('detail').className = "active";
        
        document.getElementById('d-name').innerText = data.name;
        document.getElementById('d-quote').innerText = data.quote;
        document.getElementById('d-state').innerText = data.state;
        document.getElementById('d-warn').innerText = data.warn;
        document.getElementById('d-advice').innerText = data.advice;
        document.getElementById('d-yao').innerHTML = data.yao.map(y => `<div class="yao-item">${y}</div>`).join('');
        
        // æ¯æ¬¡è¿›å…¥è¯¦æƒ…é¡µï¼Œé‡ç½®å·¥ä½œå°
        document.getElementById('report-area').style.display = 'none';
        window.scrollTo(0,0);
    }

    // æ ¸å¿ƒé€»è¾‘ï¼šè‡ªåŠ¨èµ·å¦ä¸åŠ¨çˆ»è®¡ç®—
    function calculateGua() {
        const n1 = parseInt(document.getElementById('num1').value);
        const n2 = parseInt(document.getElementById('num2').value);
        const n3 = parseInt(document.getElementById('num3').value);

        if (isNaN(n1) || isNaN(n2) || isNaN(n3)) { alert("è¯·è¾“å…¥å®Œæ•´ä¸‰ä¸ªæ•°å­—"); return; }
        if (!currentId) { alert("é€»è¾‘é”™è¯¯ï¼šè¯·å…ˆé€‰æ‹©å¦è±¡"); return; }

        // è®¡ç®—åŠ¨çˆ»é€»è¾‘
        let motion = n3 % 6;
        if (motion === 0) motion = 6;

        const data = guaData[currentId];
        const activeYao = data.yao[motion - 1]; // æŠ“å–å¯¹åº”çš„çˆ»è¾

        document.getElementById('report-area').style.display = 'block';
        document.getElementById('report-gua-title').innerText = data.name + " (ç¬¬" + motion + "çˆ»åŠ¨)";
        
        // å¡«å……å†…å®¹
        document.getElementById('edit-advice').value = data.advice;
        document.getElementById('edit-quote').value = "ã€åŠ¨çˆ»å…³é”®ã€‘" + activeYao + "\n\n" + data.quote;
        
        alert("å·²æ ¹æ®åŠ¨çˆ»ä¸ºæ‚¨æŠ“å–æ·±åº¦è§£è¯»ï¼Œå¯ç»§ç»­æ‰‹åŠ¨ä¿®æ”¹ã€‚");
    }

    // å¯¼å‡ºï¼šæ–‡å­—æŠ¥å‘Š
    function exportText() {
        const title = document.getElementById('report-gua-title').innerText;
        const advice = document.getElementById('edit-advice').value;
        const quote = document.getElementById('edit-quote').value;
        const insight = document.getElementById('my-insight').value;

        const report = `ğŸ”® å‘¨æ˜“æœ‰ç­”æ¡ˆ Â· è§£å¦æŠ¥å‘Š\n\nã€å¦ååŠ¨çˆ»ã€‘\n${title}\n\nã€è¡ŒåŠ¨å»ºè®®ã€‘\n${advice}\n\nã€æ·±åº¦è§£è¯»ã€‘\n${quote}\n\nã€æˆ‘çš„æ„Ÿæ‚Ÿã€‘\n${insight}\n\nâ€”â€” çŸ¥è¡Œåˆä¸€ï¼Œé¡ºåŠ¿è€Œä¸º â€”â€”`;
        
        navigator.clipboard.writeText(report).then(() => {
            alert("æŠ¥å‘Šå·²æˆåŠŸå¤åˆ¶ï¼");
        });
    }

    // é¢„è§ˆï¼šå›¾ç‰‡æ¨¡å¼ï¼ˆå¼¹çª—æˆªå±ï¼‰
    function exportImage() {
        const title = document.getElementById('report-gua-title').innerText;
        const advice = document.getElementById('edit-advice').value.replace(/\n/g, '<br>');
        const quote = document.getElementById('edit-quote').value.replace(/\n/g, '<br>');
        const insight = document.getElementById('my-insight').value.replace(/\n/g, '<br>');

        const win = window.open('', '_blank');
        win.document.write(`
            <html><head><style>
                body { font-family: serif; background: #f4f1ea; padding: 30px; }
                .p { border: 4px solid #d4a017; background: white; padding: 25px; max-width: 500px; margin: auto; }
                h1 { color: #a44d11; border-bottom: 2px solid #d4a017; padding-bottom: 10px; font-size: 1.5rem; }
                .label { font-weight: bold; color: #a44d11; margin-top: 20px; }
                .content { margin-top: 5px; color: #333; line-height: 1.5; font-size: 1rem; }
            </style></head><body>
                <div class="p">
                    <h1>${title}</h1>
                    <div class="label">ã€è¡ŒåŠ¨å»ºè®®ã€‘</div><div class="content">${advice}</div>
                    <div class="label">ã€æ·±åº¦è§£è¯»ã€‘</div><div class="content">${quote}</div>
                    <div class="label">ã€å®æˆ˜æ„Ÿæ‚Ÿã€‘</div><div class="content">${insight}</div>
                    <p style="text-align:right; color:#ccc; margin-top:30px;">â€”â€” æ‰‹æœºæˆªå›¾ä¿å­˜æµ·æŠ¥ â€”â€”</p>
                </div>
            </body></html>
        `);
    }

    // è¾…åŠ©åŠŸèƒ½
    function showRandom() { 
        const keys = Object.keys(guaData); 
        const randomId = keys[Math.floor(Math.random()*keys.length)];
        showDetail(randomId); 
    }
    function showList() { 
        document.getElementById('home').className = ""; 
        document.getElementById('detail').className = ""; 
        document.getElementById('list').className = "active"; 
    }
    function goHome() { 
        document.getElementById('home').className = "active"; 
        document.getElementById('detail').className = ""; 
        document.getElementById('list').className = ""; 
    }

    window.onload = init;
</script>
</body>
</html>
