<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å‘¨æ˜“æœ‰ç­”æ¡ˆ - æ™ºèƒ½è§£å¦æ‰‹å†Œ</title>
    <style>
        :root { --accent: #a44d11; --gold: #d4a017; --p: #37352f; --bg: #ffffff; --s-bg: #f7f6f3; }
        body { font-family: system-ui, -apple-system, sans-serif; color: var(--p); background: var(--bg); margin: 0; padding: 0; line-height: 1.6; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px 20px 80px 20px; }
        
        #home, #list, #detail { display: none; }
        .active { display: block !important; }

        /* é¦–é¡µèµ·å¦åŒº */
        .hero { text-align: center; padding: 40px 0; }
        .hero h1 { color: var(--accent); margin-bottom: 10px; }
        .workbench-box { background: #fffcf5; border: 2px solid var(--gold); border-radius: 15px; padding: 20px; margin: 20px 0; }
        .input-group { display: flex; gap: 10px; justify-content: center; margin: 20px 0; }
        .input-group input { width: 75px; padding: 12px; border: 1px solid #ccc; border-radius: 8px; text-align: center; font-size: 1rem; }
        
        /* æŒ‰é’®æ ·å¼ */
        .btn { display: block; width: 100%; padding: 15px; margin: 10px 0; border: 1px solid #ddd; border-radius: 12px; background: var(--s-bg); text-align: center; font-size: 1.1rem; cursor: pointer; box-sizing: border-box; text-decoration: none; color: inherit; }
        .btn-primary { background: var(--gold); color: white; border: none; font-weight: bold; }

        /* è¯¦æƒ…é¡µå±•ç¤ºåŒº */
        .section { margin: 25px 0; padding-bottom: 15px; border-bottom: 1px solid #eee; }
        .label { font-weight: bold; color: var(--accent); font-size: 0.9rem; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; }
        .content-text { font-size: 1rem; color: #444; white-space: pre-wrap; }
        
        /* å…­çˆ»è¾ä¸“ç”¨æ ·å¼ */
        .yao-list { margin-top: 10px; }
        .yao-item { padding: 12px; background: var(--s-bg); margin-bottom: 8px; border-radius: 8px; font-size: 0.95rem; border-left: 4px solid #ddd; }
        .yao-item.active-yao { border-left: 4px solid var(--gold); background: #fff9e6; font-weight: bold; }

        /* AI æé—®åŒº */
        .ask-ai-box { background: #eef6ff; padding: 15px; border-radius: 10px; border-left: 5px solid #2b6cb0; margin: 20px 0; }
        
        /* æŠ¥å‘Šç”ŸæˆåŒº */
        #report-generator { background: #f9f9f9; padding: 20px; border-radius: 12px; border: 1px dashed #ccc; margin-top: 30px; }
        textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box; font-family: inherit; line-height: 1.5; }
        
        /* åº•éƒ¨å¯¼èˆª */
        .nav-bar { position: fixed; bottom: 0; width: 100%; max-width: 600px; background: rgba(255,255,255,0.95); display: flex; border-top: 1px solid #eee; padding: 12px 0; backdrop-filter: blur(10px); z-index: 100; }
        .nav-bar div { flex: 1; text-align: center; font-size: 0.85rem; color: #666; cursor: pointer; }

        /* åˆ—è¡¨ç½‘æ ¼ */
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .card { padding: 12px; border: 1px solid #eee; text-align: center; border-radius: 8px; font-size: 0.85rem; background: white; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <div id="home" class="active">
        <div class="hero">
            <h1>å‘¨æ˜“æœ‰ç­”æ¡ˆ</h1>
            <p>ç»å…¸æ™ºæ…§èµ·å¦ä¸æ·±åº¦å¤ä¹ å·¥å…·</p>
        </div>

        <div class="workbench-box">
            <h3 style="text-align:center; color:var(--gold); margin-top:0;">ğŸ”® æ•°å­—èµ·å¦</h3>
            <div class="input-group">
                <input type="number" id="num1" placeholder="æ•°å­—1">
                <input type="number" id="num2" placeholder="æ•°å­—2">
                <input type="number" id="num3" placeholder="æ•°å­—3">
            </div>
            <button class="btn btn-primary" onclick="doDivination()">è®¡ç®—å¦è±¡ä¸åŠ¨çˆ»</button>
            <p style="font-size:0.8rem; color:#888; text-align:center;">(ç”±æ•°å­—æ±‚ï¼šä¸‹å¦ã€ä¸Šå¦ã€åŠ¨çˆ»)</p>
        </div>

        <div class="btn" onclick="showList()">ğŸ“– 64 å¦é€ŸæŸ¥è¡¨ (å¤ä¹ å…¥å£)</div>
        <div class="btn" onclick="showRandom()">ğŸ² éšæœºæŠ½å–ä¸€å¦</div>
    </div>

    <div id="list">
        <div class="btn" onclick="goHome()">â† è¿”å›é¦–é¡µ</div>
        <div class="grid" id="grid"></div>
    </div>

    <div id="detail">
        <div class="btn" onclick="goHome()">â† é‡æ–°èµ·å¦</div>
        
        <h2 id="d-name" style="color:var(--accent); margin-bottom:10px;"></h2>
        <div id="d-motion-info" style="font-weight:bold; color:var(--gold); margin-bottom:20px; font-size:1.1rem;"></div>

        <div class="ask-ai-box">
            <div class="label" style="color:#2b6cb0;">ğŸ’¡ æ·±åº¦è§£å¦å’¨è¯¢</div>
            <p style="font-size:0.9rem; margin:5px 0;">å¤åˆ¶ä¸‹æ–‡å‘ç»™æ™ºèƒ½åŠ©æ‰‹ï¼š<br><b>â€œæˆ‘æ±‚å¾—<span id="ai-gua-name"></span>ï¼ŒåŠ¨çˆ»æ˜¯<span id="ai-motion"></span>ã€‚æˆ‘æƒ³é—®[åœ¨æ­¤è¾“å…¥å…·ä½“é—®é¢˜]ï¼Œè¯·ç»“åˆæ˜“ç»æ™ºæ…§æ·±åº¦è§£è¯»ã€‚â€</b></p>
        </div>

        <div class="section">
            <div class="label">æ ¸å¿ƒé‡‘å¥</div>
            <div id="d-quote" class="content-text"></div>
        </div>

        <div class="section">
            <div class="label">å…­çˆ»è¾å†…å®¹</div>
            <div id="d-yao" class="yao-list"></div>
        </div>

        <div class="section">
            <div class="label">è¯¦ç»†æ„è±¡</div>
            <div id="d-state" class="content-text"></div>
        </div>

        <div class="section">
            <div class="label">é¿å‘æŒ‡å—</div>
            <div id="d-warn" class="content-text"></div>
        </div>

        <div class="section">
            <div class="label">è¡ŒåŠ¨å»ºè®®</div>
            <div id="d-advice" class="content-text"></div>
        </div>

        <div id="report-generator">
            <h3 style="margin-top:0;">ğŸ“‹ æŠ¥å‘Šç¼–è¾‘å°</h3>
            <p style="font-size:0.85rem; color:#666;">ç‚¹å‡»æŒ‰é’®ï¼Œè‡ªåŠ¨å°†ä¸Šè¿°æ‰€æœ‰å†…å®¹åˆå¹¶åˆ°ç¼–è¾‘æ¡†ï¼š</p>
            <button class="btn" style="background:#2c3e50; color:white; font-size:0.9rem;" onclick="prepareReport()">ç”Ÿæˆå®Œæ•´å†…å®¹å¹¶æ‰‹åŠ¨ç¼–è¾‘</button>
            
            <div id="report-edit-area" style="display:none; margin-top:15px;">
                <div class="label">ç¼–è¾‘æœ€ç»ˆæŠ¥å‘Šï¼š</div>
                <textarea id="final-report-text" rows="15"></textarea>
                
                <div style="display:flex; gap:10px; margin-top:10px;">
                    <button class="btn" style="background:var(--gold); color:white; flex:1;" onclick="copyReport()">å¤åˆ¶æ–‡æœ¬</button>
                    <button class="btn" style="background:var(--accent); color:white; flex:1;" onclick="previewPoster()">æµ·æŠ¥é¢„è§ˆ</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="nav-bar">
    <div onclick="goHome()">ğŸ”® èµ·å¦</div>
    <div onclick="showList()">ğŸ” æŸ¥å¦</div>
    <div onclick="showRandom()">ğŸ² éšæœº</div>
</div>

<script src="data.js"></script>
<script>
    let currentId = "";
    let currentMotion = 0;

    // å¦è±¡æŸ¥æ‰¾æ˜ å°„è¡¨
    const guaLookup = {
        "11":"01", "88":"02", "46":"03", "67":"04", "16":"05", "61":"06", "68":"07", "86":"08",
        "15":"09", "21":"10", "18":"11", "81":"12", "31":"13", "13":"14", "78":"15", "84":"16",
        "42":"17", "57":"18", "28":"19", "85":"20", "43":"21", "37":"22", "87":"23", "48":"24",
        "41":"25", "17":"26", "47":"27", "52":"28", "66":"29", "33":"30", "72":"31", "54":"32",
        "71":"33", "14":"34", "83":"35", "38":"36", "35":"37", "23":"38", "76":"39", "64":"40",
        "27":"41", "45":"42", "12":"43", "51":"44", "82":"45", "58":"46", "62":"47", "56":"48",
        "32":"49", "53":"50", "44":"51", "77":"52", "75":"53", "24":"54", "34":"55", "37":"56",
        "55":"57", "22":"58", "65":"59", "26":"60", "25":"61", "74":"62", "36":"63", "63":"64"
    };

    function init() {
        const grid = document.getElementById('grid');
        if (typeof guaData === 'undefined') { alert("æœªæ‰¾åˆ° data.js æ•°æ®æ–‡ä»¶"); return; }
        Object.keys(guaData).sort().forEach(id => {
            const div = document.createElement('div');
            div.className = 'card';
            div.innerText = id + " " + guaData[id].name.split('.')[1].split('(')[0].trim();
            div.onclick = () => { currentMotion=0; showDetail(id); };
            grid.appendChild(div);
        });
    }

    function doDivination() {
        const n1 = parseInt(document.getElementById('num1').value);
        const n2 = parseInt(document.getElementById('num2').value);
        const n3 = parseInt(document.getElementById('num3').value);
        if (isNaN(n1) || isNaN(n2) || isNaN(n3)) { alert("è¯·è¾“å…¥å®Œæ•´ä¸‰ä¸ªæ•°å­—"); return; }

        let lower = n1 % 8 || 8;
        let upper = n2 % 8 || 8;
        let motion = n3 % 6 || 6;
        let lookupKey = "" + lower + upper;
        let id = guaLookup[lookupKey];

        if (!id) { alert("æ‰¾ä¸åˆ°å¯¹åº”å¦è±¡ï¼Œè¯·æ£€æŸ¥æ•°å­—"); return; }
        currentMotion = motion;
        showDetail(id);
    }

    function showDetail(id) {
        currentId = id;
        const data = guaData[id];
        document.getElementById('home').className = "";
        document.getElementById('list').className = "";
        document.getElementById('detail').className = "active";
        
        document.getElementById('d-name').innerText = data.name;
        document.getElementById('ai-gua-name').innerText = data.name;
        
        // æ¸²æŸ“åŠ¨çˆ»ä¿¡æ¯
        const yaoContainer = document.getElementById('d-yao');
        yaoContainer.innerHTML = "";
        data.yao.forEach((text, index) => {
            const yaoIdx = index + 1;
            const div = document.createElement('div');
            div.className = 'yao-item';
            if (yaoIdx === currentMotion) {
                div.className += ' active-yao';
                div.innerHTML = `<strong>ç¬¬${yaoIdx}çˆ»(åŠ¨)ï¼š${text}</strong>`;
            } else {
                div.innerHTML = `ç¬¬${yaoIdx}çˆ»ï¼š${text}`;
            }
            yaoContainer.appendChild(div);
        });

        if (currentMotion > 0) {
            document.getElementById('d-motion-info').innerText = "âš–ï¸ åŠ¨çˆ»æŒ‡å¼•ï¼šç¬¬ " + currentMotion + " çˆ»";
            document.getElementById('ai-motion').innerText = "ç¬¬ " + currentMotion + " çˆ» (" + data.yao[currentMotion-1] + ")";
        } else {
            document.getElementById('d-motion-info').innerText = "âœ¨ é™å¦ï¼šå‚è€ƒå…¨å¦å¤§æ„";
            document.getElementById('ai-motion').innerText = "æ— ";
        }

        document.getElementById('d-quote').innerText = data.quote;
        document.getElementById('d-state').innerText = data.state;
        document.getElementById('d-warn').innerText = data.warn;
        document.getElementById('d-advice').innerText = data.advice;
        
        // é‡ç½®æŠ¥å‘Šç¼–è¾‘åŒº
        document.getElementById('report-edit-area').style.display = 'none';
        window.scrollTo(0,0);
    }

    function prepareReport() {
        const data = guaData[currentId];
        let yaoContent = data.yao.map((y, i) => `ç¬¬${i+1}çˆ»ï¼š${y}`).join('\n');
        const motionInfo = currentMotion > 0 ? `ã€å½“å‰åŠ¨çˆ»ã€‘ç¬¬${currentMotion}çˆ»\nçˆ»è¾ï¼š${data.yao[currentMotion-1]}` : "ã€å½“å‰å¦è±¡ã€‘é™å¦";
        
        const prefilled = `ã€ğŸ”® æ˜“ç»è§£å¦æŠ¥å‘Šã€‘\n\n` +
                          `å¦åï¼š${data.name}\n` +
                          `${motionInfo}\n\n` +
                          `ã€æ ¸å¿ƒé‡‘å¥ã€‘\n${data.quote}\n\n` +
                          `ã€å…­çˆ»å…¨è¾ã€‘\n${yaoContent}\n\n` +
                          `ã€è¯¦ç»†æ„è±¡ã€‘\n${data.state}\n\n` +
                          `ã€é¿å‘æŒ‡å—ã€‘\n${data.warn}\n\n` +
                          `ã€è¡ŒåŠ¨å»ºè®®ã€‘\n${data.advice}\n\n` +
                          `ã€æ·±åº¦åˆ†æä¸æ„Ÿæ‚Ÿã€‘\n(æ­¤å¤„ç²˜è´´AIçš„æ·±åº¦å»ºè®®æˆ–è¾“å…¥æ‚¨çš„ä¸ªäººæ„Ÿæ‚Ÿ...)\n\n` +
                          `â€”â€” çŸ¥è¡Œåˆä¸€ï¼Œé¡ºåŠ¿è€Œä¸º â€”â€”`;
        
        document.getElementById('final-report-text').value = prefilled;
        document.getElementById('report-edit-area').style.display = 'block';
    }

    function copyReport() {
        const text = document.getElementById('final-report-text').value;
        navigator.clipboard.writeText(text).then(() => alert("æŠ¥å‘Šå†…å®¹å·²å¤åˆ¶"));
    }

    function previewPoster() {
        const content = document.getElementById('final-report-text').value.replace(/\n/g, '<br>');
        const win = window.open('', '_blank');
        win.document.write(`
            <html><head><style>
                body { font-family: serif; background: #f4f1ea; padding: 20px; }
                .p { border: 4px solid #d4a017; background: white; padding: 25px; max-width: 600px; margin: auto; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
                h2 { color: #a44d11; border-bottom: 2px solid #d4a017; padding-bottom: 10px; text-align: center; }
                .content { font-size: 1rem; line-height: 1.6; color: #333; }
            </style></head><body>
                <div class="p"><h2>è§£å¦æŠ¥å‘Š</h2><div class="content">${content}</div></div>
            </body></html>
        `);
    }

    function goHome() { document.getElementById('home').className = "active"; document.getElementById('list').className = ""; document.getElementById('detail').className = ""; }
    function showList() { document.getElementById('home').className = ""; document.getElementById('detail').className = ""; document.getElementById('list').className = "active"; }
    function showRandom() { const keys = Object.keys(guaData); showDetail(keys[Math.floor(Math.random()*keys.length)]); }
    window.onload = init;
</script>
</body>
</html>
